# ── Image ────────────────────────────────────────────────────────────
image:
  repository: localhost:5000/tol-pipeline   # registry local k3s
  tag: latest
  pullPolicy: IfNotPresent

# ── Namespace ────────────────────────────────────────────────────────
namespace: vector

# ── S3 OVH ───────────────────────────────────────────────────────────
s3:
  endpoint: "https://s3.gra.io.cloud.ovh.net"
  bucket: "taxonline-datalake"
  region: "gra"
  # Credentials → stockés dans un Secret (voir secret.yaml)
  secretName: "tol-pipeline-s3"

# ── Qdrant ───────────────────────────────────────────────────────────
qdrant:
  url: "http://qdrant.vector.svc.cluster.local:6333"
  collection: "taxonline_chunks_v1"

# ── Ollama (embeddings) ───────────────────────────────────────────────
ollama:
  url: "http://ollama.ollama.svc.cluster.local:11434"
  model: "nomic-embed-text"
  timeout: "120"

# ── OpenSearch ────────────────────────────────────────────────────────
opensearch:
  url: "https://opensearch-cluster-master.opensearch.svc.cluster.local:9200"
  index: "taxonline_chunks"
  secretName: "tol-pipeline-opensearch"

# ── Pipeline settings ─────────────────────────────────────────────────
pipeline:
  # Dossiers dans le PersistentVolume
  dataPath: "/data/datalake"
  bronzePath: "/data/datalake/bronze"
  silverPath: "/data/datalake/silver"
  goldPath: "/data/datalake/gold"

  # Chunking
  chunkChars: "2000"
  overlapChars: "200"
  minChars: "50"       # ← 50 et non 200 pour ne pas rater les petites pages
  skipToc: "1"
  dedup: "1"

  # Indexation
  batchQdrant: "64"
  batchOpensearch: "200"

# ── Jobs ──────────────────────────────────────────────────────────────
jobs:
  # Job fix_missing : indexe uniquement les chunks manquants dans Qdrant/OS
  fixMissing:
    enabled: true
    name: "fix-missing-chunks"
    ttlSecondsAfterFinished: 3600
    resources:
      requests:
        memory: "512Mi"
        cpu: "250m"
      limits:
        memory: "2Gi"
        cpu: "1000m"

  # Job full pipeline : extract → chunk → index → verify
  fullPipeline:
    enabled: false   # mettre true pour lancer le pipeline complet
    name: "full-pipeline"
    ttlSecondsAfterFinished: 7200
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "4Gi"
        cpu: "2000m"

# ── CronJob ───────────────────────────────────────────────────────────
cronJob:
  enabled: false          # mettre true pour activer le pipeline automatique
  schedule: "0 2 * * *"  # chaque nuit à 2h00
  name: "pipeline-nightly"
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

# ── PersistentVolume ──────────────────────────────────────────────────
persistence:
  enabled: true
  existingClaim: ""        # si PVC existant, mettre son nom ici
  storageClass: "local-path"
  size: "20Gi"
  mountPath: "/data/datalake"
  # hostPath pour k3s single-node (monte /data/datalake de la VM)
  hostPath: "/data/datalake"

