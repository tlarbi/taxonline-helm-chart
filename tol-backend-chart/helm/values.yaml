# ============================================================
# TaxOnline Dashboard - Global Values
# ============================================================
# Each sub-chart (frontend/backend) can be deployed independently
# to allow migration to API Gateway or CDN without touching the other.

global:
  imageRegistry: "harbor.your-registry.dz"
  imagePullSecrets:
    - name: harbor-secret
  storageClass: "standard"
  environment: "production"  # development | staging | production

# ============================================================
# Backend Sub-chart Configuration
# ============================================================
backend:
  enabled: true

  image:
    repository: "harbor.your-registry.dz/taxonline/dashboard-backend"
    tag: "latest"
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000

  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

  # PostgreSQL (existing cluster)
  postgresql:
    host: "postgresql.database.svc.cluster.local"
    port: 5432
    database: "taxonline_dashboard"
    username: "taxonline"
    existingSecret: "taxonline-pg-secret"
    secretKey: "password"

  # Qdrant (existing cluster)
  qdrant:
    host: "qdrant.qdrant.svc.cluster.local"
    port: 6333
    collectionName: "tax_documents"
    existingSecret: "qdrant-api-secret"
    secretKey: "api-key"

  # OpenSearch (existing cluster)
  opensearch:
    host: "opensearch.opensearch.svc.cluster.local"
    port: 9200
    index: "tax_documents"
    existingSecret: "opensearch-secret"
    secretKey: "password"

  # Ollama (existing cluster)
  ollama:
    host: "ollama.ollama.svc.cluster.local"
    port: 11434
    model: "mistral:7b"

  # JWT Auth config
  auth:
    existingSecret: "taxonline-auth-secret"
    secretKey: "jwt-secret"
    tokenExpireMinutes: 480

  # S3 / MinIO
  s3:
    endpoint: "http://minio.minio.svc.cluster.local:9000"
    bucket: "taxonline-documents"
    existingSecret: "minio-secret"

  env:
    CORS_ORIGINS: "https://dashboard.taxonline.dz"
    LOG_LEVEL: "INFO"
    WORKERS: "4"

  # WebSocket for pipeline logs
  websocket:
    enabled: true
    pingInterval: 30

  podAnnotations: {}

  nodeSelector: {}

  tolerations: []

  affinity: {}

  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /health/ready
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5

# ============================================================
# Frontend Sub-chart Configuration
# ============================================================
frontend:
  enabled: true

  image:
    repository: "harbor.your-registry.dz/taxonline/dashboard-frontend"
    tag: "latest"
    pullPolicy: IfNotPresent

  replicaCount: 2

  service:
    type: ClusterIP
    port: 80
    targetPort: 80

  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"

  # API URL - can point to backend service, API gateway, or external URL
  # This is the KEY parameter for migration: change this to point to API Gateway
  apiUrl: "https://api.taxonline.dz"

  # WebSocket URL for real-time pipeline logs
  wsUrl: "wss://api.taxonline.dz/ws"

  podAnnotations: {}

  nodeSelector: {}

  tolerations: []

  affinity: {}

  livenessProbe:
    httpGet:
      path: /
      port: 80
    initialDelaySeconds: 10
    periodSeconds: 30

# ============================================================
# Ingress Configuration
# ============================================================
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "500m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"

  # Frontend host
  frontendHost: "dashboard.taxonline.dz"

  # Backend API host (can be replaced by API Gateway hostname)
  backendHost: "api.taxonline.dz"

  tls:
    - secretName: taxonline-dashboard-tls
      hosts:
        - dashboard.taxonline.dz
        - api.taxonline.dz
